<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>Reviews | Schoology</title>
    <link rel="icon" type="image/x-icon" href="./icons/schoology2.png">
    <meta property="og:title" content="Play unblocked games online">
    <meta property="og:description" content="SCHOOLOGY">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://kit.fontawesome.com/d0c5025972.js" crossorigin="anonymous"></script>
    <meta name="theme-color" content="var(--bgColor)">
    <script src="panicButton.js"></script> <!-- Include panicButton.js -->

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDlmJ6xkhZ0EeHP89OkQhvgiQp7oFA8vyo",
            authDomain: "reviews-playgamez.firebaseapp.com",
            projectId: "reviews-playgamez",
            storageBucket: "reviews-playgamez.appspot.com",
            messagingSenderId: "797570756984",
            appId: "1:797570756984:web:e7d30e710c22216fab188d",
            measurementId: "G-04QCKSGP03"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
</head>
<body>
    <!-- Particles JS Background -->
    <div id="particles-js"></div>

    <!-- Top Bar -->
    <div class="top-bar">
        <a id="homeTab" href="index.html">Home</a>
        <a id="gamesTab" href="games.html">Games</a>
        <a id="proxyTab" href="#proxy">Proxy</a>
        <a id="movieTab" href="movie.html">Movies</a>
        <a id="reviewsTab" class="tab-highlight" href="reviews.html">Reviews</a>
        <a id="settingsTab" href="settings.html">Settings</a>
    </div>

    <!-- Toggle Delete Mode Button -->
    <button id="toggleDeleteMode" class="button">Toggle Delete Mode</button>

    <!-- Delete Mode Notification -->
    <div id="deleteNotification" class="delete-notification">
        Delete Mode is ON. Press 'd e l e t e' again to turn it OFF.
    </div>

    <!-- Review Form -->
    <div class="review-form">
        <h1 class="animated jello game_title">Leave a Review</h1>
        <form id="reviewForm">
            <input type="text" id="name" placeholder="Your Name" required>
            <textarea id="review" placeholder="Your Review" required></textarea>
            <div class="star-rating">
                <span class="fa fa-star" data-rating="1"></span>
                <span class="fa fa-star" data-rating="2"></span>
                <span class="fa fa-star" data-rating="3"></span>
                <span class="fa fa-star" data-rating="4"></span>
                <span class="fa fa-star" data-rating="5"></span>
            </div>
            <input type="hidden" id="rating" value="0">
            <button type="submit" class="button">Submit Review</button>
        </form>
    </div>

    <!-- Reviews Container -->
    <div class="reviews-container">
        <h2 class="animated jello game_title">User Reviews</h2>
        <div id="reviewsList"></div>
    </div>

    <!-- Particles JS -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        particlesJS.load('particles-js', 'particles.json', function() {
            console.log('particles.js loaded');
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const reviewForm = document.getElementById('reviewForm');
            const reviewsList = document.getElementById('reviewsList');
            const stars = document.querySelectorAll('.star-rating .fa-star');
            const toggleDeleteModeButton = document.getElementById('toggleDeleteMode');
            let isDeleteMode = false;

            // Listen for reviews changes
            database.ref('reviews').on('value', (snapshot) => {
                const reviews = snapshot.val() || {};
                displayReviews(reviews);
            });

            // Star rating functionality
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = this.getAttribute('data-rating');
                    document.getElementById('rating').value = rating;
                    stars.forEach(s => s.classList.remove('checked'));
                    for (let i = 0; i < rating; i++) {
                        stars[i].classList.add('checked');
                    }
                });
            });

            // Handle form submission
            reviewForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const name = document.getElementById('name').value;
                const review = document.getElementById('review').value;
                const rating = document.getElementById('rating').value;
                const date = new Date().toLocaleDateString("en-US");

                // Input validation
                if (name.trim() === '' || review.trim() === '' || rating === '0') {
                    alert('Please complete all fields and select a rating.');
                    return;
                }

                const reviewObject = { name, review, rating, likes: 0, date };

                // Add new review to Firebase
                database.ref('reviews').push(reviewObject);
                reviewForm.reset();
                stars.forEach(star => star.classList.remove('checked'));
            });

            function displayReviews(reviews) {
                reviewsList.innerHTML = '';
                Object.keys(reviews).forEach((key) => {
                    const review = reviews[key];
                    const reviewDiv = document.createElement('div');
                    reviewDiv.className = 'review';
                    reviewDiv.innerHTML = `
                        <h3>${review.name}</h3>
                        <p>${review.review}</p>
                        <div class="star-rating">
                            ${getStarRatingHTML(review.rating)}
                        </div>
                        <div>
                            <span>${review.date}</span>
                            <span class="like-button" data-key="${key}"><i class="fa fa-thumbs-up"></i> ${review.likes}</span>
                            <span class="delete-button" data-key="${key}" style="display: none;"><i class="fa fa-times"></i></span>
                        </div>
                    `;
                    reviewsList.prepend(reviewDiv);
                });
                addLikeButtonListeners();
                addDeleteButtonListeners();
                updateDeleteButtons();
            }

            function getStarRatingHTML(rating) {
                let html = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= rating) {
                        html += `<span class="fa fa-star checked"></span>`;
                    } else {
                        html += `<span class="fa fa-star"></span>`;
                    }
                }
                return html;
            }

            function addLikeButtonListeners() {
                const likeButtons = document.querySelectorAll('.like-button');
                likeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const key = this.getAttribute('data-key');
                        database.ref('reviews/' + key + '/likes').transaction((likes) => {
                            return (likes || 0) + 1;
                        });
                    });
                });
            }

            function addDeleteButtonListeners() {
                const deleteButtons = document.querySelectorAll('.delete-button');
                deleteButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const key = this.getAttribute('data-key');
                        database.ref('reviews/' + key).remove();
                    });
                });
            }

            function updateDeleteButtons() {
                const deleteButtons = document.querySelectorAll('.delete-button');
                deleteButtons.forEach(button => {
                    button.style.display = isDeleteMode ? 'inline' : 'none';
                });
            }

            toggleDeleteModeButton.addEventListener('click', function() {
                isDeleteMode = !isDeleteMode;
                deleteNotification.style.display = isDeleteMode ? 'block' : 'none';
                updateDeleteButtons();
            });

            let deleteCode = "";
            const deleteNotification = document.getElementById('deleteNotification');
            document.addEventListener('keydown', function(event) {
                deleteCode += event.key.toLowerCase();
                if (deleteCode.length > 7) {
                    deleteCode = deleteCode.slice(-7);
                }
                if (deleteCode === "d e l e t e") {
                    isDeleteMode = !isDeleteMode;
                    deleteNotification.style.display = isDeleteMode ? 'block' : 'none';
                    updateDeleteButtons();
                }
            });
        });
    </script>
</body>
</html>
